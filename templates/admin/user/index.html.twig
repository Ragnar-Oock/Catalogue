{% extends 'base.html.twig' %}

{% block title %}User index{% endblock %}

{% block main %}
<section class="custom-container">
	<h1>User index</h1>

	<table class="table table-responsive">
		<thead>
			<tr>
				<th>Email</th>
				<th>Prénom</th>
				<th>Nom</th>
				<th>Inscrit le</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody>
		{% for user in users %}
			<tr>
				<td>
				{% if user.email is same as('') %}
					<span class="text-muted">Compte supprimé</span>
				{% else %}
					{{ user.email }}		
				{% endif %}
				
				
				{% if 'ROLE_ADMIN' in user.roles %}
						<span class="badge badge-primary" title="Cet utilisateur est administrateur">{% include "icons/shield-shaded.svg.twig" %}</span>
					{% elseif user.roles is empty %}
						<span class="badge badge-primary" title="Cet utilisateur à été banni">{% include "icons/hammer.svg.twig" %}</span>
					{% endif %}</td>
				<td>{{ user.firstname }}</td>
				<td>{{ user.lastname }}</td>
				<td>{{ user.registeredAt ? user.registeredAt|date('d/m/Y') : '' }}</td>
				<td class="py-1">

					{% if 'ROLE_ADMIN' in user.roles %}
						<form
							method="post"
							action="{{ path('user_delete', {'user': user.id}) }}"
							onsubmit="return confirm('Etes vous sur de vouloir supprimer ce compte?');"
							id="{{user.id}}-delete"
						>
							<input type="hidden" name="_method" value="DELETE">
							<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
						</form>

						<form
							method="post"
							action="{{ path('user_promote', {'user': user.id}) }}"
							onsubmit="return confirm('Etes vous sur de vouloir promouvoir cet utilisateur au rang d'administrateur?');"
							id="{{user.id}}-promote"
						>
							<input type="hidden" name="_method" value="DELETE">
							<input type="hidden" name="_token" value="{{ csrf_token('promote' ~ user.id) }}">
						</form>

					{% endif %}
					
					<form
						method="post"
						action="{{ path('user_bannish', {'user': user.id}) }}"
						onsubmit="return confirm('Etes vous sur de vouloir bannir cet utilisateur?');"
						id="{{user.id}}-bannish"
					>
						<input type="hidden" name="_method" value="DELETE">
						<input type="hidden" name="_token" value="{{ csrf_token('bannish' ~ user.id) }}">
					</form>


						{% if app.user.id is not same as(user.id) and user.email is not same as('') %}
							<div class="btn-group">
								<button class="btn btn-outline-danger" title="bannir l'utilisateur" form="{{user.id}}-bannish">{% include "icons/hammer.svg.twig" %}</button>
								<button class="btn btn-outline-danger" title="supprimer le compte" form="{{user.id}}-delete">{% include "icons/trash-fill.svg.twig" %}</button>
							</div>
							<button class="btn btn-secondary" title="Promouvoir l'utilisateur" form="{{user.id}}-promote">{% include "icons/shield-shaded.svg.twig" %}</button>
						{% endif %}
						
				</td>
			</tr>
		{% else %}
			<tr>
				<td colspan="8">no records found</td>
			</tr>
		{% endfor %}
		</tbody>
	</table>
</section>
{% endblock %}
